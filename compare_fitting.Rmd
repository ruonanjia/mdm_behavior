---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(ggplot2)
library(PerformanceAnalytics)
library(psych)

```

```{r}
data_summary <- function(data, varname, groupnames){
  # Function to calculate the mean and the standard error
  # for each group
  #+++++++++++++++++++++++++
  # data : a data frame
  # varname : the name of a column containing the variable
  #to be summariezed
  # groupnames : vector of column names to be used as
  # grouping variables
  
  require(plyr)
  summary_func <- function(x, col){
    c(mean = mean(x[[col]], na.rm=TRUE),
      sd = sd(x[[col]], na.rm=TRUE)/sqrt(length(x[[col]])))
  }
  data_sum<-ddply(data, groupnames, .fun=summary_func,
                  varname)
  data_sum <- rename(data_sum, c("mean" = varname))
  return(data_sum)
}
```


Load data sheet
```{r}
fitpar_path <- 'D:/Ruonan/Projects in the lab/MDM Project/Medical Decision Making Imaging/MDM_imaging/Behavioral Analysis/Behavior fitpar files'

wave1 = '09300119'
wave2 = '09300219'
wave3 = '08230319'
# wave4 = ''

file1 = file.path(fitpar_path, paste('Behavior data fitpar_', wave1, sep=''), paste('param_Behavior data fitpar_', wave1, '.txt', sep=''))
file2 = file.path(fitpar_path, paste('Behavior data fitpar_', wave2, sep=''), paste('param_Behavior data fitpar_', wave2, '.txt', sep=''))
file3 = file.path(fitpar_path, paste('Behavior data fitpar_', wave3, sep=''), paste('param_Behavior data fitpar_', wave3, '.txt', sep=''))


fit1 <- read.delim(file1, header = TRUE, sep = "\t")
fit2 <- read.delim(file2, header = TRUE, sep = "\t")
fit3 <- read.delim(file3, header = TRUE, sep = "\t")

View(fit2)
```


```{r}
fit1$val_start = 1
fit2$val_start = 2
fit3$val_start = 3
colnames(fit1)
```

```{r}
names(fit1)
# monetary values
val_plot = rbind(fit1[,c(5:8, 30)], fit2[,c(5:8, 30)], fit3[,c(5:8, 30)])
val_plot$val_start = as.factor(val_plot$val_start)
val_plot$id = as.factor(fit1$id)

# medical values
val_plot = rbind(fit1[,c(19:22, 30)], fit2[,c(19:22, 30)], fit3[,c(19:22, 30)])
val_plot$val_start = as.factor(val_plot$val_start)
val_plot$id = as.factor(fit1$id)
```

```{r}
val2plot <- data_summary(val_plot,varname='val1_mon',groupnames=c("val_start"))
ggplot(data=val2plot,aes(x=val_start, y = val1_mon), fill=val_start) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val1_mon-sd, ymax=val1_mon+sd), width=0.2, position=position_dodge(0.9))

val2plot <- data_summary(val_plot,varname='val2_mon',groupnames=c("val_start"))
ggplot(data=val2plot,aes(x=val_start, y = val2_mon), fill=val_start) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val2_mon-sd, ymax=val2_mon+sd), width=0.2, position=position_dodge(0.9))

val2plot <- data_summary(val_plot,varname='val3_mon',groupnames=c("val_start"))
ggplot(data=val2plot,aes(x=val_start, y = val3_mon), fill=val_start) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val3_mon-sd, ymax=val3_mon+sd), width=0.2, position=position_dodge(0.9))

val2plot <- data_summary(val_plot,varname='val4_mon',groupnames=c("val_start"))
ggplot(data=val2plot,aes(x=val_start, y = val4_mon), fill=val_start) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val4_mon-sd, ymax=val4_mon+sd), width=0.2, position=position_dodge(0.9))

View(val_plot)

```


Nomalize value
```{r}
colnames(val_plot)

val_norm <- as.data.frame(t(apply(val_plot[,1:4], 1, function(x) (x - mean(x))/sd(x))))

# monetary
val_plot[, 7:10] = data.frame("val1_mon_norm" = val_norm[,1],
                             "val2_mon_norm" = val_norm[,2],
                             "val3_mon_norm" = val_norm[,3],
                             "val4_mon_norm" = val_norm[,4])

# medical
val_plot[, 7:10] = data.frame("val1_med_norm" = val_norm[,1],
                             "val2_med_norm" = val_norm[,2],
                             "val3_med_norm" = val_norm[,3],
                             "val4_med_norm" = val_norm[,4])
```

reorganize data frame for plotting values
```{r}
val_plot2 <- val_plot

# # monetary
# colnames(val_plot2)[7] <- 'val_mon_norm'
# colnames(val_plot2)[8] <- 'val_mon_norm'
# colnames(val_plot2)[9] <- 'val_mon_norm'
# colnames(val_plot2)[10] <- 'val_mon_norm'
# 
# colnames(val_plot2)[1] <- 'val_mon'
# colnames(val_plot2)[2] <- 'val_mon'
# colnames(val_plot2)[3] <- 'val_mon'
# colnames(val_plot2)[4] <- 'val_mon'

# medical
colnames(val_plot2)[7] <- 'val_med_norm'
colnames(val_plot2)[8] <- 'val_med_norm'
colnames(val_plot2)[9] <- 'val_med_norm'
colnames(val_plot2)[10] <- 'val_med_norm'

colnames(val_plot2)[1] <- 'val_med'
colnames(val_plot2)[2] <- 'val_med'
colnames(val_plot2)[3] <- 'val_med'
colnames(val_plot2)[4] <- 'val_med'

View(val_plot2)

val_plot2$level1 <- 1
val_plot2$level2 <- 2
val_plot2$level3 <- 3
val_plot2$level4 <- 4

colnames(val_plot2)

colnames(val_plot2)[11:14] <- "level"

val_plot2$reward1 <- 5
val_plot2$reward2 <- 8
val_plot2$reward3 <- 12
val_plot2$reward4 <- 25

colnames(val_plot2)[15:18] <- "reward"

colnames(val_plot2)

val_plot_re <- rbind(val_plot2[,c(6,5,1,7,11,15)],val_plot2[,c(6,5,2,8,12,16)], val_plot2[,c(6,5,3,9,13,17)],val_plot2[,c(6,5,4,10,14,18)])

View(val_plot_re)
```


Plot distributions of fitted value parameters
```{r}
val_plot_re$level <- as.factor(val_plot_re$level)
val_start2plot = 3
ggplot(val_plot_re[val_plot_re$val_start == val_start2plot,], aes(x=val_mon, fill = level, color = level)) +
  geom_histogram(position = "identity", alpha = 0.6) +
  # geom_histogram(position = "identity", alpha = 0.6, breaks=seq(0,1000,10)) +
  scale_fill_brewer(palette="YlOrRd") +
  scale_color_brewer(palette="YlOrRd") +
  ggtitle(paste("Value search starting point", val_start2plot))
```

Distribution of normalized values
```{r}
val_plot_re$level <- as.factor(val_plot_re$level)
val_start2plot = 2
ggplot(val_plot_re[val_plot_re$val_start == val_start2plot,], aes(x=val_med_norm, fill = level, color = level)) +
  geom_histogram(position = "identity", alpha = 0.6) +
  # geom_histogram(position = "identity", alpha = 0.6, breaks=seq(-1.6,1.6,0.05)) +
  scale_fill_brewer(palette="YlOrRd") +
  scale_color_brewer(palette="YlOrRd") +
  ggtitle(paste("Value search starting point", val_start2plot))
```

Correlation between normalized values, monetary
```{r}
monpar_plot <- data.frame('val1_norm_10' = val_plot$val1_mon_norm[val_plot$val_start==10],
                          'val1_norm_50' = val_plot$val1_mon_norm[val_plot$val_start==50],
                          'val1_norm_100' = val_plot$val1_mon_norm[val_plot$val_start==100])

chart.Correlation(monpar_plot)

monpar_plot <- data.frame('val2_norm_10' = val_plot$val2_mon_norm[val_plot$val_start==10],
                          'val2_norm_50' = val_plot$val2_mon_norm[val_plot$val_start==50],
                          'val2_norm_100' = val_plot$val2_mon_norm[val_plot$val_start==100])

chart.Correlation(monpar_plot)

monpar_plot <- data.frame('val3_norm_10' = val_plot$val3_mon_norm[val_plot$val_start==10],
                          'val3_norm_50' = val_plot$val3_mon_norm[val_plot$val_start==50],
                          'val3_norm_100' = val_plot$val3_mon_norm[val_plot$val_start==100])

chart.Correlation(monpar_plot)

monpar_plot <- data.frame('val4_norm_10' = val_plot$val4_mon_norm[val_plot$val_start==10],
                          'val4_norm_50' = val_plot$val4_mon_norm[val_plot$val_start==50],
                          'val4_norm_100' = val_plot$val4_mon_norm[val_plot$val_start==100])

chart.Correlation(monpar_plot)
```

Correlation between normalized values, medical
```{r}
medpar_plot <- data.frame('val1_norm_10' = val_plot$val1_med_norm[val_plot$val_start==10],
                          'val1_norm_50' = val_plot$val1_med_norm[val_plot$val_start==50],
                          'val1_norm_100' = val_plot$val1_med_norm[val_plot$val_start==100])

chart.Correlation(medpar_plot)

medpar_plot <- data.frame('val2_norm_10' = val_plot$val2_med_norm[val_plot$val_start==10],
                          'val2_norm_50' = val_plot$val2_med_norm[val_plot$val_start==50],
                          'val2_norm_100' = val_plot$val2_med_norm[val_plot$val_start==100])

chart.Correlation(medpar_plot)

medpar_plot <- data.frame('val3_norm_10' = val_plot$val3_med_norm[val_plot$val_start==10],
                          'val3_norm_50' = val_plot$val3_med_norm[val_plot$val_start==50],
                          'val3_norm_100' = val_plot$val3_med_norm[val_plot$val_start==100])

chart.Correlation(medpar_plot)

medpar_plot <- data.frame('val4_norm_10' = val_plot$val4_med_norm[val_plot$val_start==10],
                          'val4_norm_50' = val_plot$val4_med_norm[val_plot$val_start==50],
                          'val4_norm_100' = val_plot$val4_med_norm[val_plot$val_start==100])

chart.Correlation(medpar_plot)
```


plot normalized value by value starting search point, monetary
```{r}
val2plot <- data_summary(val_plot,varname='val1_mon_norm',groupnames=c("val_start"))
ggplot(data=val2plot,aes(x=val_start, y = val1_mon_norm), fill=val_start) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val1_mon_norm-sd, ymax=val1_mon_norm+sd), width=0.2, position=position_dodge(0.9))

val2plot <- data_summary(val_plot,varname='val2_mon_norm',groupnames=c("val_start"))
ggplot(data=val2plot,aes(x=val_start, y = val2_mon_norm), fill=val_start) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val2_mon_norm-sd, ymax=val2_mon_norm+sd), width=0.2, position=position_dodge(0.9))

val2plot <- data_summary(val_plot,varname='val3_mon_norm',groupnames=c("val_start"))
ggplot(data=val2plot,aes(x=val_start, y = val3_mon_norm), fill=val_start) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val3_mon_norm-sd, ymax=val3_mon_norm+sd), width=0.2, position=position_dodge(0.9))

val2plot <- data_summary(val_plot,varname='val4_mon_norm',groupnames=c("val_start"))
ggplot(data=val2plot,aes(x=val_start, y = val4_mon_norm), fill=val_start) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val4_mon_norm-sd, ymax=val4_mon_norm+sd), width=0.2, position=position_dodge(0.9))
```

plot normalized value by value starting search point, medical
```{r}
val2plot <- data_summary(val_plot,varname='val1_med_norm',groupnames=c("val_start"))
ggplot(data=val2plot,aes(x=val_start, y = val1_med_norm), fill=val_start) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val1_med_norm-sd, ymax=val1_med_norm+sd), width=0.2, position=position_dodge(0.9))

val2plot <- data_summary(val_plot,varname='val2_med_norm',groupnames=c("val_start"))
ggplot(data=val2plot,aes(x=val_start, y = val2_med_norm), fill=val_start) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val2_med_norm-sd, ymax=val2_med_norm+sd), width=0.2, position=position_dodge(0.9))

val2plot <- data_summary(val_plot,varname='val3_med_norm',groupnames=c("val_start"))
ggplot(data=val2plot,aes(x=val_start, y = val3_med_norm), fill=val_start) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val3_med_norm-sd, ymax=val3_med_norm+sd), width=0.2, position=position_dodge(0.9))

val2plot <- data_summary(val_plot,varname='val4_med_norm',groupnames=c("val_start"))
ggplot(data=val2plot,aes(x=val_start, y = val4_med_norm), fill=val_start) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val4_med_norm-sd, ymax=val4_med_norm+sd), width=0.2, position=position_dodge(0.9))
```

Plot value parameters, monetary
```{r}
val_start2plot = 3
val2plot <- data_summary(val_plot_re[val_plot_re$val_start ==val_start2plot,],
                         varname = 'val_mon',
                         groupnames = 'level')

ggplot(val2plot, aes(x=level, y=val_mon)) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val_mon-sd, ymax=val_mon+sd), width=0.2, position=position_dodge(0.9)) + 
  ggtitle(paste('Value search starting point', val_start2plot))


val2plot <- data_summary(val_plot_re[val_plot_re$val_start ==val_start2plot,],
                         varname = 'val_mon',
                         groupnames = 'reward')

ggplot(val2plot, aes(x=reward, y=val_mon)) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val_mon-sd, ymax=val_mon+sd), width=0.2, position=position_dodge(0.9)) + 
  scale_x_continuous(breaks = seq(5,25,5)) +
  ggtitle(paste('Value search starting point', val_start2plot))

# ggplot(val_plot_re[val_plot_re$val_start ==val_start2plot,], aes(x=reward, y=val_mon_norm)) + 
#   geom_point() +
#   geom_smooth(method = 'nls', formula = y~ power(x)) +
#   # geom_smooth(method = "gam") +
#   scale_x_continuous(breaks = seq(5,25,5)) +
#   ggtitle(paste('Value search starting point', val_start2plot))
```


Plot normalized value parameters, monetary
```{r}
val_start2plot = 3
val2plot <- data_summary(val_plot_re[val_plot_re$val_start ==val_start2plot,],
                         varname = 'val_mon_norm',
                         groupnames = 'level')

ggplot(val2plot, aes(x=level, y=val_mon_norm)) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val_mon_norm-sd, ymax=val_mon_norm+sd), width=0.2, position=position_dodge(0.9)) + 
  ggtitle(paste('Value search starting point', val_start2plot))


val2plot <- data_summary(val_plot_re[val_plot_re$val_start ==val_start2plot,],
                         varname = 'val_mon_norm',
                         groupnames = 'reward')

ggplot(val2plot, aes(x=reward, y=val_mon_norm)) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val_mon_norm-sd, ymax=val_mon_norm+sd), width=0.2, position=position_dodge(0.9)) + 
  scale_x_continuous(breaks = seq(5,25,5)) +
  ggtitle(paste('Value search starting point', val_start2plot))

# ggplot(val_plot_re[val_plot_re$val_start ==val_start2plot,], aes(x=reward, y=val_mon_norm)) + 
#   geom_point() +
#   geom_smooth(method = 'nls', formula = y~ power(x)) +
#   # geom_smooth(method = "gam") +
#   scale_x_continuous(breaks = seq(5,25,5)) +
#   ggtitle(paste('Value search starting point', val_start2plot))
```

Plot value parameters, medical
```{r}
val_start2plot = 3
val2plot <- data_summary(val_plot_re[val_plot_re$val_start ==val_start2plot,],
                         varname = 'val_med',
                         groupnames = 'level')

ggplot(val2plot, aes(x=level, y=val_med)) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val_med-sd, ymax=val_med+sd), width=0.2, position=position_dodge(0.9)) + 
  ggtitle(paste('Value search starting point', val_start2plot))

```

Plot normalized value parameters, medical
```{r}
val_start2plot = 3
val2plot <- data_summary(val_plot_re[val_plot_re$val_start ==val_start2plot,],
                         varname = 'val_med_norm',
                         groupnames = 'level')

ggplot(val2plot, aes(x=level, y=val_med_norm)) + 
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymin=val_med_norm-sd, ymax=val_med_norm+sd), width=0.2, position=position_dodge(0.9)) + 
  ggtitle(paste('Value search starting point', val_start2plot))

```

Comparing adjusted BIC
```{r}
monpar_plot <- data.frame('BIC_1' = fit1$BIC_mon,'BIC_2'= fit2$BIC_mon, 'BIC_3' = fit3$BIC_mon)
chart.Correlation(monpar_plot)

medpar_plot <- data.frame('BIC_1' = fit1$BIC_med,'BIC_2'= fit2$BIC_med, 'BIC_3' = fit3$BIC_med)
chart.Correlation(medpar_plot)
```

alpha
```{r}
monpar_plot <- data.frame('alpha_1' = fit1$alpha_mon,'alpha_2'= fit2$alpha_mon, 'alpha_3' = fit3$alpha_mon)
chart.Correlation(monpar_plot)

monpar_plot <- data.frame('alpha_1' = fit1$alpha_mon,'alpha_2'= fit2$alpha_mon)
chart.Correlation(monpar_plot)

medpar_plot <- data.frame('alpha_1' = fit1$alpha_med,'alpha_2'= fit2$alpha_med, 'alpha_3' = fit3$alpha_med)
chart.Correlation(medpar_plot)
```

beta
```{r}
monpar_plot <- data.frame('beta_1' = fit1$beta_mon,'beta_2'= fit2$beta_mon, 'beta_3' = fit3$beta_mon)
chart.Correlation(monpar_plot, histogram = TRUE)
# chart.Correlation(monpar_plot[monpar_plot$beta_100<400,], histogram = TRUE)


medpar_plot <- data.frame('beta_1' = fit1$beta_med,'beta_2'= fit2$beta_med, 'beta_3' = fit3$beta_med)
chart.Correlation(medpar_plot, histogram = TRUE)
# chart.Correlation(medpar_plot[medpar_plot$beta_100>-100,])

# View(fit3)
```

```{r}
# sort fit1 and fit2 by id
par_plot <- data.frame('r2_1' = fit1$r2_adj_mon,'r2_2'= fit2$r2_adj_mon)

ggplot(par_plot, aes(x=r2_1, y=r2_2)) +
  geom_point() +
  scale_x_continuous(limits = c(0,1)) +
  scale_y_continuous(limits = c(0,1)) +
  geom_abline(intercept = 0, slope = 1, color = "blue") +
  xlab('Grid step = 0.5') + ylab('Grid step = 0.2')
```



```{r}
ggplot(fit2, aes(x=beta_mon, y=beta_med)) +
  geom_point() +
  geom_smooth(method = "lm")
  # scale_x_continuous(limits=c(-1.5, 6)) +
  # scale_y_continuous(limits=c(-1.5, 6)) +
  # geom_abline(intercept = 0, slope = 1, color = "blue")

print(corr.test(x = fit2$beta_mon,
          y = fit2$beta_med,
          method = "spearman"),
      digits = 7)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
